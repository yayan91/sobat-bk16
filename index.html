<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOBAT BK - 16</title>
    
    <!-- Google Fonts: Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Konfigurasi Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Poppins', 'sans-serif'] },
                    colors: {
                        brand: { light: '#a78bfa', DEFAULT: '#8b5cf6', dark: '#7c3aed' }
                    }
                }
            }
        }
    </script>

    <style>
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Custom Scrollbar Global */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Hide scrollbar for clean tabs on mobile */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* Professional Tab Styling */
        .tab-active { background-color: #ffffff; color: #8b5cf6; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); font-weight: 700; }
        .tab-inactive { color: #64748b; font-weight: 500; }
        .tab-inactive:hover { color: #475569; background-color: rgba(255, 255, 255, 0.4); }

        /* Internal Scroll untuk Grid yang tidak memanjang */
        .grid-scroll-area { max-height: 55vh; overflow-y: auto; padding-right: 0.5rem; padding-bottom: 2rem; }
        
        /* Glassmorphism */
        .glass-header { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(226, 232, 240, 0.8); }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans overflow-hidden flex flex-col h-screen">

    <!-- ========================================== -->
    <!-- 1. HALAMAN LOGIN -->
    <!-- ========================================== -->
    <div id="login-view" class="h-screen w-screen flex items-center justify-center bg-gradient-to-br from-blue-400 via-purple-500 to-pink-500 p-4 absolute inset-0 z-50">
        <button onclick="showModal('about-modal')" class="absolute top-6 right-6 text-white text-3xl hover:scale-110 transition-transform drop-shadow-md">
            <i class="fa-solid fa-circle-info"></i>
        </button>

        <div class="bg-white/95 backdrop-blur-sm p-8 rounded-3xl shadow-2xl w-full max-w-md fade-in text-center relative overflow-hidden">
            <div class="absolute -top-10 -left-10 w-32 h-32 bg-purple-200 rounded-full mix-blend-multiply blur-xl opacity-70"></div>
            <div class="relative z-10">
                
                <!-- LOGO APLIKASI (Silakan Ganti URL src-nya nanti) -->
                <img src="https://drive.google.com/thumbnail?id=1Z6g-sCdw-k7W8dnw12NeagPkroLlmk-L" id="login-logo-img" alt="Logo Aplikasi" class="w-24 h-24 mx-auto mb-4 object-contain drop-shadow-lg rounded-2xl bg-white p-2">
                
                <h1 class="text-3xl font-bold text-slate-800 mb-1">SOBAT BK</h1>
                <p class="text-sm text-slate-500 mb-8 font-medium">Sistem Online BK & Administrasi Terpadu</p>

                <form id="login-form" onsubmit="handleLogin(event)" class="space-y-5 text-left">
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1 ml-1">Username</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400"><i class="fa-solid fa-user"></i></div>
                            <input type="text" id="login-username" required class="w-full pl-11 pr-4 py-3 bg-slate-100 border-none rounded-xl focus:ring-2 focus:ring-brand text-slate-700" placeholder="Masukkan Username Guru">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1 ml-1">Password</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400"><i class="fa-solid fa-lock"></i></div>
                            <input type="password" id="login-password" required class="w-full pl-11 pr-12 py-3 bg-slate-100 border-none rounded-xl focus:ring-2 focus:ring-brand text-slate-700" placeholder="Masukkan Password">
                            <button type="button" onclick="togglePassword('login-password', 'eye-icon')" class="absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-brand transition-colors">
                                <i id="eye-icon" class="fa-solid fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="w-full py-3.5 bg-gradient-to-r from-brand to-pink-500 hover:from-brand-dark text-white rounded-xl font-bold text-lg shadow-lg hover:-translate-y-1 transition-all">
                        Masuk Aplikasi <i class="fa-solid fa-arrow-right-to-bracket ml-2"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- 2. DASHBOARD UTAMA -->
    <!-- ========================================== -->
    <div id="main-dashboard" class="hidden flex-1 flex flex-col relative w-full h-full overflow-hidden">
        
        <!-- HEADER Keren (Glassmorphism) -->
        <header class="glass-header px-4 md:px-8 py-3 flex justify-between items-center z-20 sticky top-0">
            <div class="flex items-center gap-3">
                <!-- LOGO HEADER (Mengganti ikon lama) -->
                <img src="https://drive.google.com/thumbnail?id=1Z6g-sCdw-k7W8dnw12NeagPkroLlmk-L" id="header-logo-img" alt="Logo" class="w-10 h-10 md:w-12 md:h-12 rounded-xl shadow-md cursor-pointer hover:scale-105 transition-transform object-cover bg-white p-1" onclick="showModal('about-modal')">
                
                <div>
                    <h1 class="font-bold text-xl md:text-2xl text-slate-800 leading-tight tracking-tight">SOBAT BK</h1>
                    <!-- SLOGAN APLIKASI (Mengganti nama guru) -->
                    <p class="text-[9px] md:text-[10px] font-bold text-transparent bg-clip-text bg-gradient-to-r from-brand to-pink-500 tracking-widest uppercase">Mappaguru Online</p>
                </div>
            </div>
            
            <div class="flex items-center gap-2 md:gap-4">
                <div class="hidden md:block text-right cursor-pointer group" onclick="showProfil()">
                    <p class="text-sm font-bold text-slate-800 group-hover:text-brand transition-colors" id="user-display-name">Memuat...</p>
                    <p class="text-xs text-slate-500 group-hover:text-brand-light transition-colors"><i class="fa-solid fa-pen-to-square mr-1"></i>Profil Saya</p>
                </div>
                <div class="relative">
                    <img src="https://ui-avatars.com/api/?name=User&background=8b5cf6&color=fff" id="user-avatar" onclick="showProfil()" class="w-10 h-10 md:w-12 md:h-12 rounded-full border-2 border-brand cursor-pointer hover:scale-110 shadow-sm transition-transform object-cover" alt="Profil">
                    <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>
                </div>
                
                <button onclick="logout()" class="ml-1 md:ml-3 w-10 h-10 md:w-11 md:h-11 rounded-full bg-slate-100 text-slate-500 hover:bg-red-500 hover:text-white transition-all shadow-sm flex items-center justify-center" title="Keluar">
                    <i class="fa-solid fa-power-off text-lg"></i>
                </button>
            </div>
        </header>

        <!-- KONTEN UTAMA DENGAN SCROLL GLOBAL -->
        <main class="flex-1 overflow-y-auto w-full bg-slate-50/50 relative">
            
            <!-- BANNER & DASHBOARD STATS -->
            <div class="px-4 md:px-8 pt-6 pb-2 max-w-7xl mx-auto">
                <div class="bg-gradient-to-r from-brand-dark via-brand to-pink-500 rounded-3xl p-6 md:p-8 text-white shadow-xl relative overflow-hidden mb-6">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full blur-3xl -mr-20 -mt-20"></div>
                    <div class="relative z-10">
                        <h2 class="text-2xl md:text-3xl font-bold mb-2">Halo, <span id="banner-name">Sahabat</span>! ðŸ‘‹</h2>
                        <p class="text-white/80 text-sm md:text-base mb-6 max-w-xl">Selamat datang di Apliaksi Sobat BK Ruang Kerja Digital Anda. Pantau layanan, materi bimbingan, dan video ajar hari ini dengan mudah.</p>
                        
                        <!-- Statistik Cards -->
                        <div class="grid grid-cols-3 gap-3 md:gap-6">
                            <div class="bg-white/10 backdrop-blur-md rounded-2xl p-3 md:p-4 border border-white/20 text-center">
                                <i class="fa-solid fa-layer-group text-2xl md:text-3xl text-white/90 mb-2"></i>
                                <h3 class="text-2xl md:text-3xl font-bold" id="stat-aplikasi">0</h3>
                                <p class="text-[10px] md:text-xs font-semibold text-white/70 uppercase tracking-wider">Aplikasi</p>
                            </div>
                            <div class="bg-white/10 backdrop-blur-md rounded-2xl p-3 md:p-4 border border-white/20 text-center">
                                <i class="fa-solid fa-book-open-reader text-2xl md:text-3xl text-white/90 mb-2"></i>
                                <h3 class="text-2xl md:text-3xl font-bold" id="stat-media">0</h3>
                                <p class="text-[10px] md:text-xs font-semibold text-white/70 uppercase tracking-wider">Media RPLBK</p>
                            </div>
                            <div class="bg-white/10 backdrop-blur-md rounded-2xl p-3 md:p-4 border border-white/20 text-center">
                                <i class="fa-brands fa-youtube text-2xl md:text-3xl text-white/90 mb-2"></i>
                                <h3 class="text-2xl md:text-3xl font-bold" id="stat-video">0</h3>
                                <p class="text-[10px] md:text-xs font-semibold text-white/70 uppercase tracking-wider">Video Ajar</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NAVIGASI TAB PROFESIONAL (DITENGAH) -->
                <div class="mb-6 overflow-x-auto scrollbar-hide flex justify-center w-full">
                    <div class="flex gap-2 p-1.5 bg-slate-200/60 rounded-2xl w-max backdrop-blur-sm">
                        <button onclick="switchTab('aplikasi')" id="tab-aplikasi" class="px-5 py-2.5 rounded-xl text-sm transition-all tab-active flex items-center gap-2">
                            <i class="fa-solid fa-layer-group"></i> Layanan Aplikasi
                        </button>
                        <button onclick="switchTab('media')" id="tab-media" class="px-5 py-2.5 rounded-xl text-sm transition-all tab-inactive flex items-center gap-2">
                            <i class="fa-solid fa-book-open-reader"></i> Media dan RPLBK
                        </button>
                        <button onclick="switchTab('video')" id="tab-video" class="px-5 py-2.5 rounded-xl text-sm transition-all tab-inactive flex items-center gap-2">
                            <i class="fa-brands fa-youtube"></i> Video Pembelajaran
                        </button>
                    </div>
                </div>

                <!-- TAB 1: APLIKASI -->
                <div id="content-aplikasi" class="fade-in block pb-10">
                    <div class="flex justify-between items-center mb-4 px-1">
                        <h2 class="text-xl font-bold text-slate-800">Aplikasi Mappaguru Online</h2>
                        <button onclick="loadDataAplikasi()" class="text-xs font-semibold text-brand hover:text-brand-dark bg-brand-light/10 px-3 py-1.5 rounded-lg transition-colors"><i class="fa-solid fa-rotate-right mr-1"></i> Refresh</button>
                    </div>
                    <!-- Area Scroll Internal -->
                    <div class="grid-scroll-area">
                        <div id="grid-aplikasi" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                            <div class="col-span-full text-center py-10 text-slate-400"><i class="fa-solid fa-spinner fa-spin text-3xl mb-3"></i><p>Memuat layanan...</p></div>
                        </div>
                    </div>
                </div>

                <!-- TAB 2: MEDIA AJAR -->
                <div id="content-media" class="fade-in hidden pb-10">
                    <div class="flex justify-between items-center mb-4 px-1">
                        <h2 class="text-xl font-bold text-slate-800">Media BK dan RPLBK</h2>
                        <button onclick="showModal('modal-upload-media')" class="bg-brand hover:bg-brand-dark text-white px-4 py-2 rounded-xl text-sm font-semibold shadow-md transition-all hover:-translate-y-0.5"><i class="fa-solid fa-cloud-arrow-up mr-2"></i>Upload Baru</button>
                    </div>
                    <!-- Area Scroll Internal -->
                    <div class="grid-scroll-area">
                        <div id="grid-media" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            <div class="col-span-full text-center py-10 text-slate-400">Silakan muat data atau upload media baru.</div>
                        </div>
                    </div>
                </div>

                <!-- TAB 3: VIDEO YOUTUBE -->
                <div id="content-video" class="fade-in hidden pb-10">
                    <div class="flex justify-between items-center mb-4 px-1">
                        <h2 class="text-xl font-bold text-slate-800">Koleksi Video Ajar</h2>
                        <button onclick="showModal('modal-tambah-video')" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-xl text-sm font-semibold shadow-md transition-all hover:-translate-y-0.5"><i class="fa-solid fa-plus mr-2"></i>Tambah Video</button>
                    </div>
                    <!-- Area Scroll Internal -->
                    <div class="grid-scroll-area">
                        <div id="grid-video" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            <div class="col-span-full text-center py-10 text-slate-400">Belum ada video ditambahkan.</div>
                        </div>
                    </div>
                </div>

            </div>
        </main>

        <!-- FOOTER KEREN -->
        <footer class="bg-gradient-to-r from-slate-800 to-slate-900 text-slate-300 py-3 md:py-4 px-6 text-center text-[10px] md:text-xs z-20 border-t border-slate-700">
            <p><strong>SOBAT BK</strong> &copy; 2026 | Sistem Online BK & Administrasi Terpadu</p>
            <p class="mt-1">Dibuat dengan <i class="fa-solid fa-heart text-pink-500 animate-pulse mx-1"></i> oleh <span class="text-brand-light font-bold">Muhammad Hasratul</span></p>
        </footer>
    </div>

    <!-- ========================================== -->
    <!-- 3. TAMPILAN IFRAME (SATU PINTU) -->
    <!-- ========================================== -->
    <div id="iframe-view" class="hidden h-screen flex flex-col bg-slate-100 absolute inset-0 z-[60]">
        <header class="bg-gradient-to-r from-brand-dark via-brand to-pink-500 shadow-lg px-4 py-3 flex items-center gap-4 text-white z-20">
            <button onclick="tutupIframe()" class="bg-white/20 hover:bg-white/30 backdrop-blur-md px-4 py-2 rounded-xl transition-all font-semibold flex items-center gap-2 shadow-sm">
                <i class="fa-solid fa-arrow-left"></i> <span class="hidden sm:inline">Kembali ke Dashboard</span>
            </button>
            <h2 id="iframe-title" class="text-lg md:text-xl font-bold flex-1 text-center line-clamp-1 pr-12 md:pr-0">Memuat...</h2>
        </header>
        <div class="flex-1 w-full relative bg-white">
            <div id="iframe-loader" class="absolute inset-0 flex flex-col items-center justify-center bg-slate-50 z-10">
                <div class="w-16 h-16 border-4 border-slate-200 border-t-brand border-l-pink-500 rounded-full animate-spin mb-4"></div>
                <p class="text-slate-500 font-medium animate-pulse">Memuat Aplikasi...</p>
            </div>
            <iframe id="main-iframe" class="w-full h-full border-none opacity-0 transition-opacity duration-500" onload="document.getElementById('iframe-loader').classList.add('hidden'); this.style.opacity='1';"></iframe>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- MODAL: POPUP DETAIL APLIKASI / MEDIA -->
    <!-- ========================================== -->
    <div id="modal-detail" class="fixed inset-0 z-[80] hidden bg-slate-900/60 backdrop-blur-sm overflow-y-auto">
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl shadow-2xl w-full max-w-sm md:max-w-md relative overflow-hidden fade-in flex flex-col text-center">
                <!-- Header Gambar/Ikon -->
                <div class="bg-slate-50 p-6 flex flex-col justify-center items-center relative border-b border-slate-100">
                    <button onclick="closeModal('modal-detail')" class="absolute top-4 right-4 text-slate-400 hover:text-red-500 hover:rotate-90 transition-all text-2xl w-8 h-8 flex items-center justify-center bg-white rounded-full shadow-sm"><i class="fa-solid fa-xmark"></i></button>
                    <div id="detail-img-container" class="mt-4 mb-2">
                        <!-- Ikon/Gambar disisipkan oleh JavaScript -->
                    </div>
                </div>
                <!-- Konten Deskripsi -->
                <div class="p-6 md:p-8 flex flex-col">
                    <h2 id="detail-title" class="text-xl md:text-2xl font-bold text-slate-800 mb-3 leading-tight">Nama Layanan</h2>
                    <p id="detail-desc" class="text-sm text-slate-500 leading-relaxed mb-8">Deskripsi layanan akan muncul di sini secara rinci...</p>
                    
                    <button id="btn-open-detail" class="w-full py-3.5 rounded-xl font-bold bg-gradient-to-r from-brand to-brand-dark text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2">
                        <i class="fa-solid fa-arrow-up-right-from-square"></i> Buka Sekarang
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- MODAL: PROFIL GURU (EDITABLE KECUALI USERNAME) -->
    <!-- ========================================== -->
    <div id="modal-profil" class="fixed inset-0 z-[70] hidden bg-slate-900/60 backdrop-blur-sm overflow-y-auto">
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl shadow-2xl w-full max-w-4xl relative overflow-hidden fade-in">
                <div class="bg-gradient-to-r from-brand to-brand-dark p-6 text-white flex justify-between items-center">
                    <h2 class="text-xl md:text-2xl font-bold"><i class="fa-solid fa-user-pen mr-2"></i> Profil Lengkap Guru</h2>
                    <button onclick="closeModal('modal-profil')" class="text-white/80 hover:text-white hover:rotate-90 transition-all text-2xl"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="p-6 md:p-8">
                    <form id="form-profil" onsubmit="simpanProfil(event)">
                        <div class="flex flex-col md:flex-row gap-8">
                            <!-- Kolom Kiri: Foto Profil -->
                            <div class="w-full md:w-1/3 flex flex-col items-center">
                                <div class="relative group">
                                    <img id="preview-foto-profil" src="https://ui-avatars.com/api/?name=User" class="w-40 h-40 rounded-full border-4 border-brand-light shadow-xl object-cover mb-4">
                                    <div class="absolute inset-0 bg-black/40 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity mb-4 cursor-pointer" onclick="document.getElementById('input-foto-profil').click()">
                                        <i class="fa-solid fa-camera text-3xl text-white"></i>
                                    </div>
                                </div>
                                <label class="cursor-pointer bg-slate-100 hover:bg-slate-200 text-slate-700 px-4 py-2 rounded-xl text-sm font-semibold transition-colors w-full text-center border border-slate-200">
                                    <i class="fa-solid fa-image mr-2"></i> Pilih Foto Baru
                                    <input type="file" id="input-foto-profil" class="hidden" accept="image/*" onchange="previewImage(this, 'preview-foto-profil')">
                                </label>
                                <p class="text-[10px] text-slate-400 mt-2 text-center">Format: JPG/PNG. Ukuran maks: 2MB.</p>
                            </div>
                            <!-- Kolom Kanan: Data Form -->
                            <div class="w-full md:w-2/3 grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1">Username (Kunci)</label>
                                    <input type="text" id="prof-username" readonly class="w-full p-2.5 bg-slate-100 border border-slate-200 rounded-xl text-slate-500 cursor-not-allowed font-mono text-sm">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1">Password</label>
                                    <input type="password" id="prof-password" required class="w-full p-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand outline-none text-sm transition-shadow">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1">Nama Lengkap & Gelar</label>
                                    <input type="text" id="prof-nama" required class="w-full p-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand outline-none text-sm transition-shadow">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1">NIP / NUPTK</label>
                                    <input type="text" id="prof-nip" class="w-full p-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand outline-none text-sm transition-shadow">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1">Pendidikan Terakhir</label>
                                    <input type="text" id="prof-pendidikan" class="w-full p-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand outline-none text-sm transition-shadow">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1">Tempat Lahir</label>
                                    <input type="text" id="prof-tempat-lahir" class="w-full p-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand outline-none text-sm transition-shadow">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1">Tanggal Lahir</label>
                                    <input type="date" id="prof-tgl-lahir" class="w-full p-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand outline-none text-sm transition-shadow">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1">Jenis Kelamin</label>
                                    <select id="prof-jk" class="w-full p-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand outline-none text-sm transition-shadow">
                                        <option value="Laki-laki">Laki-laki</option>
                                        <option value="Perempuan">Perempuan</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1">Agama</label>
                                    <input type="text" id="prof-agama" class="w-full p-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand outline-none text-sm transition-shadow">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1">No. WhatsApp</label>
                                    <input type="text" id="prof-wa" class="w-full p-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand outline-none text-sm transition-shadow">
                                </div>
                                <div>
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1">Email</label>
                                    <input type="email" id="prof-email" class="w-full p-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand outline-none text-sm transition-shadow">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-1">Alamat Lengkap</label>
                                    <textarea id="prof-alamat" rows="2" class="w-full p-2.5 bg-white border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand outline-none text-sm transition-shadow"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="mt-8 border-t border-slate-100 pt-6 flex justify-end gap-3">
                            <button type="button" onclick="closeModal('modal-profil')" class="px-6 py-2.5 rounded-xl font-bold text-slate-500 hover:bg-slate-100 transition-colors">Batal</button>
                            <button type="submit" class="px-8 py-2.5 rounded-xl font-bold bg-gradient-to-r from-brand to-brand-dark text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 flex items-center transition-all"><i class="fa-solid fa-floppy-disk mr-2"></i> Simpan Perubahan</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- MODAL: UPLOAD MEDIA AJAR -->
    <!-- ========================================== -->
    <div id="modal-upload-media" class="fixed inset-0 z-[70] hidden bg-slate-900/60 backdrop-blur-sm overflow-y-auto">
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl shadow-2xl w-full max-w-xl fade-in overflow-hidden">
                <div class="bg-gradient-to-r from-brand to-brand-dark p-5 text-white flex justify-between items-center">
                    <h2 class="text-xl font-bold"><i class="fa-solid fa-cloud-arrow-up mr-2"></i> Upload Media/RPLBK</h2>
                    <button onclick="closeModal('modal-upload-media')" class="text-white/80 hover:text-white hover:rotate-90 transition-all text-xl"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <form id="form-media" onsubmit="submitMedia(event)" class="p-6 space-y-5">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Judul Media/RPLBK</label>
                        <input type="text" id="media-judul" required class="w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand outline-none text-sm" placeholder="Contoh: Bahaya Bullying di Sekolah">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Deskripsi Singkat</label>
                        <textarea id="media-deskripsi" required rows="2" class="w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand outline-none text-sm" placeholder="Isi ringkasan materi..."></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="border-2 border-dashed border-slate-300 rounded-2xl p-4 text-center hover:bg-brand-light/10 hover:border-brand-light transition-colors group relative cursor-pointer" onclick="document.getElementById('media-file-kover').click()">
                            <i class="fa-regular fa-image text-3xl text-brand mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="text-[11px] font-bold text-slate-700 mb-1">Upload Kover / Ikon</p>
                            <p class="text-[9px] text-slate-400" id="label-kover">Pilih File (JPG/PNG)</p>
                            <input type="file" id="media-file-kover" required accept="image/*" class="hidden" onchange="document.getElementById('label-kover').innerText = this.files[0].name">
                        </div>
                        <div class="border-2 border-dashed border-slate-300 rounded-2xl p-4 text-center hover:bg-red-50 hover:border-red-400 transition-colors group relative cursor-pointer" onclick="document.getElementById('media-file-dokumen').click()">
                            <i class="fa-solid fa-file-pdf text-3xl text-red-500 mb-2 group-hover:scale-110 transition-transform"></i>
                            <p class="text-[11px] font-bold text-slate-700 mb-1">Upload File Materi</p>
                            <p class="text-[9px] text-slate-400" id="label-dokumen">Pilih File (PDF/PPT)</p>
                            <input type="file" id="media-file-dokumen" required accept=".pdf,.doc,.docx,.ppt,.pptx" class="hidden" onchange="document.getElementById('label-dokumen').innerText = this.files[0].name">
                        </div>
                    </div>
                    <button type="submit" class="w-full py-3.5 mt-2 rounded-xl font-bold bg-gradient-to-r from-brand to-brand-dark text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all"><i class="fa-solid fa-cloud-arrow-up mr-2"></i> Mulai Upload ke Drive</button>
                </form>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- MODAL: TAMBAH VIDEO YOUTUBE -->
    <!-- ========================================== -->
    <div id="modal-tambah-video" class="fixed inset-0 z-[70] hidden bg-slate-900/60 backdrop-blur-sm overflow-y-auto">
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="bg-white rounded-3xl shadow-2xl w-full max-w-md fade-in overflow-hidden">
                <div class="bg-gradient-to-r from-red-500 to-red-700 p-5 text-white flex justify-between items-center">
                    <h2 class="text-xl font-bold"><i class="fa-brands fa-youtube mr-2"></i> Tambah Video Ajar</h2>
                    <button onclick="closeModal('modal-tambah-video')" class="text-white/80 hover:text-white hover:rotate-90 transition-all text-xl"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <form id="form-video" onsubmit="submitVideo(event)" class="p-6 space-y-5">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Judul Video</label>
                        <input type="text" id="vid-judul" required class="w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-red-500 outline-none text-sm">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Deskripsi Singkat</label>
                        <textarea id="vid-deskripsi" required rows="2" class="w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-red-500 outline-none text-sm"></textarea>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Link YouTube</label>
                        <input type="url" id="vid-url" required placeholder="https://youtube.com/watch?v=..." class="w-full p-3 border border-slate-300 rounded-xl focus:ring-2 focus:ring-red-500 outline-none text-sm">
                    </div>
                    <button type="submit" class="w-full py-3.5 mt-2 rounded-xl font-bold bg-gradient-to-r from-red-500 to-red-600 text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all"><i class="fa-solid fa-save mr-2"></i> Simpan Video</button>
                </form>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- MODAL TENTANG APLIKASI -->
    <!-- ========================================== -->
    <div id="about-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm" onclick="if(event.target===this) closeModal('about-modal')">
        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-lg relative z-10 overflow-hidden fade-in text-center">
            <div class="bg-gradient-to-r from-brand-dark via-brand to-pink-500 p-8 text-white relative">
                <i class="fa-solid fa-rocket text-5xl mb-3 drop-shadow-md"></i>
                <h2 class="text-3xl font-bold">SOBAT BK</h2>
                <p class="text-sm text-white/80 mt-1 font-medium tracking-wide">Sistem Online BK & Administrasi Terpadu</p>
            </div>
            <div class="p-8 space-y-5">
                <p class="text-slate-600 text-sm leading-relaxed">Platform Aplikasi dirancang khusus untuk mempermudah tugas Guru BK dalam satu pintu. Semua aplikasi, media, dan riwayat dalam genggaman.</p>
                <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100 shadow-inner">
                    <p class="text-xs text-slate-400 uppercase tracking-wider font-bold">Pengembang Utama</p>
                    <p class="text-xl font-bold text-brand mt-1"><i class="fa-solid fa-code mr-2 text-pink-500"></i>Muhammad Hasratul</p>
                </div>
                <button onclick="closeModal('about-modal')" class="px-8 py-3 bg-slate-800 text-white rounded-full font-bold shadow-md hover:bg-slate-700 hover:shadow-lg transition-all w-full">Tutup</button>
            </div>
        </div>
    </div>


    <!-- ========================================== -->
    <!-- JAVASCRIPT REAL LOGIC -->
    <!-- ========================================== -->
    <script>
        // MASUKKAN URL GOOGLE APPS SCRIPT DI SINI
        const GAS_URL = "https://script.google.com/macros/s/AKfycbweEj4gDwUtAbWMU9vn4yuOpZnetKyI6DwZsrfptx5NnGgVOmHiSSxJ7_-CM2DfNT9i/exec"; 
        
        let currentUser = {}; 

        // Fungsi Super Cerdas: Mengubah URL Drive biasa menjadi format LH3 murni untuk gambar di Frontend
        function extractLh3Url(url) {
            if (!url) return 'https://via.placeholder.com/300x200?text=No+Image';
            if (url.includes('lh3.googleusercontent.com')) return url; // Jika sudah lh3
            
            // Mencari ID unik Drive dari berbagai format link
            let idMatch = url.match(/(?:id=|\/d\/)([a-zA-Z0-9_-]{25,})/);
            if (idMatch && idMatch[1]) {
                // Konversi langsung ke format LH3 dengan resolusi tinggi (=s0)
                return `https://lh3.googleusercontent.com/d/${idMatch[1]}=s0`;
            }
            return url; // Kembalikan url asli jika bukan link drive
        }

        // Fungsi memperbarui Dashboard Stat
        function updateStats(tipe, jumlah) {
            const el = document.getElementById('stat-' + tipe);
            if(el) el.innerText = jumlah;
        }

        // =====================================
        // FUNGSI FETCH REAL KE BACKEND (GAS)
        // =====================================
        async function fetchAPI(action, payload = {}) {
            if (GAS_URL === "URL_APPS_SCRIPT_SAHABAT_DISINI") {
                Swal.fire('Oops!', 'URL Google Apps Script belum disetel.', 'warning');
                return { status: "error" };
            }
            try {
                Swal.showLoading();
                const response = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify({ action: action, ...payload }) });
                const result = await response.json();
                Swal.close();
                return result;
            } catch (error) {
                Swal.close();
                Swal.fire('Koneksi Gagal', 'Pastikan jaringan stabil.', 'error');
                return { status: "error" };
            }
        }

        // =====================================
        // LOGIKA LOGIN
        // =====================================
        async function handleLogin(event) {
            event.preventDefault();
            const user = document.getElementById("login-username").value;
            const pass = document.getElementById("login-password").value;

            Swal.fire({ title: 'Tunggu Yah...', allowOutsideClick: false, didOpen: () => { Swal.showLoading(); }});

            const res = await fetchAPI('login', { username: user, password: pass });
            if(res.status === "error" && GAS_URL === "URL_APPS_SCRIPT_SAHABAT_DISINI") { simulasiLogin(user); return; }

            if (res.status === "success") { simulasiLogin(user, res.data); } 
            else { Swal.fire('Gagal', res.pesan || 'Username atau Password salah.', 'error'); }
        }

        function simulasiLogin(username, realData = null) {
            Swal.fire({ title: 'Login Berhasil!', icon: 'success', timer: 1500, showConfirmButton: false, customClass: { popup: 'rounded-3xl' } });
            
            currentUser = realData || { username: username, nama_lengkap: username };
            
            // Update UI dengan foto berformat LH3
            let finalAvatarUrl = extractLh3Url(currentUser.url_foto_profil);
            if(!currentUser.url_foto_profil) finalAvatarUrl = `https://ui-avatars.com/api/?name=${currentUser.nama_lengkap}&background=8b5cf6&color=fff`;
            
            document.getElementById("user-display-name").innerText = currentUser.nama_lengkap;
            document.getElementById("banner-name").innerText = currentUser.nama_lengkap.split(' ')[0]; // Ambil nama panggilan
            document.getElementById("user-avatar").src = finalAvatarUrl;
            
            document.getElementById("login-view").classList.add("hidden");
            document.getElementById("main-dashboard").classList.remove("hidden");
            
            // Load Semua Data Awal
            loadDataAplikasi();
            loadDataMedia();
            loadDataVideo();
        }

        function logout() {
            Swal.fire({ title: 'Keluar?', text: "Sesi Anda akan diakhiri.", icon: 'question', showCancelButton: true, confirmButtonColor: '#8b5cf6', confirmButtonText: 'Ya', customClass: { popup: 'rounded-3xl' } })
            .then((res) => {
                if (res.isConfirmed) {
                    currentUser = {};
                    document.getElementById("login-form").reset();
                    document.getElementById("main-dashboard").classList.add("hidden");
                    document.getElementById("login-view").classList.remove("hidden");
                }
            });
        }

        // =====================================
        // MANAJEMEN TAB & KONTEN (MODERN PILLS)
        // =====================================
        function switchTab(tabName) {
            ['aplikasi', 'media', 'video'].forEach(t => {
                let btn = document.getElementById('tab-' + t);
                btn.classList.remove('tab-active');
                btn.classList.add('tab-inactive');
                document.getElementById('content-' + t).classList.add('hidden');
            });
            let actBtn = document.getElementById('tab-' + tabName);
            actBtn.classList.remove('tab-inactive');
            actBtn.classList.add('tab-active');
            document.getElementById('content-' + tabName).classList.remove('hidden');

            if (tabName === 'aplikasi') loadDataAplikasi();
            if (tabName === 'media') loadDataMedia();
            if (tabName === 'video') loadDataVideo();
        }

        // =====================================
        // RENDER DATA & MODAL DETAIL
        // =====================================
        
        // Membuka Modal Detail Aplikasi (Pop-up sebelum dibuka di Iframe)
        function openDetailApp(el) {
            let url = el.getAttribute('data-url');
            let title = el.getAttribute('data-title');
            let desc = decodeURIComponent(el.getAttribute('data-desc'));
            let iconHtml = decodeURIComponent(el.getAttribute('data-icon'));
            
            document.getElementById('detail-title').innerText = title;
            document.getElementById('detail-desc').innerText = desc;
            
            // Manipulasi kelas agar ikon terlihat besar dan proporsional di dalam modal
            let imgContainer = document.getElementById('detail-img-container');
            imgContainer.innerHTML = iconHtml;
            
            let divIcon = imgContainer.querySelector('div');
            if(divIcon) { divIcon.className = "w-24 h-24 bg-brand-light/20 text-brand rounded-3xl flex items-center justify-center mx-auto text-4xl shadow-inner"; }
            let imgIcon = imgContainer.querySelector('img');
            if(imgIcon) { imgIcon.className = "w-24 h-24 object-contain mx-auto drop-shadow-md"; }

            let btnOpen = document.getElementById('btn-open-detail');
            btnOpen.innerHTML = '<i class="fa-solid fa-arrow-up-right-from-square mr-2"></i> Buka Aplikasi';
            btnOpen.onclick = () => { closeModal('modal-detail'); bukaIframe(url, title); };
            
            showModal('modal-detail');
        }

        async function loadDataAplikasi() {
            const grid = document.getElementById("grid-aplikasi");
            grid.innerHTML = '<div class="col-span-full text-center py-10 text-slate-400"><i class="fa-solid fa-spinner fa-spin text-3xl mb-3"></i><p>Menarik data Aplikasi...</p></div>';
            
            const res = await fetchAPI('getAplikasi');
            if(res.status === "success") {
                grid.innerHTML = "";
                updateStats('aplikasi', res.data.length);
                res.data.forEach(app => {
                    let finalIconUrl = extractLh3Url(app.url_ikon);
                    let iconHtml = app.url_ikon.includes("http") ? `<img src="${finalIconUrl}" class="w-12 h-12 object-contain mx-auto mb-3 drop-shadow-sm">` : `<div class="w-14 h-14 bg-brand-light/20 text-brand rounded-2xl flex items-center justify-center mx-auto mb-3 text-2xl shadow-inner"><i class="${app.url_ikon}"></i></div>`;
                    let appTitleSafe = app.nama_aplikasi.replace(/'/g, "\\'");
                    
                    // Konfigurasi Klik dengan pop-up (Modal Detail)
                    let btnClick = `onclick="openDetailApp(this)" data-url="${app.url_aplikasi}" data-title="${appTitleSafe}" data-desc="${encodeURIComponent(app.deskripsi)}" data-icon="${encodeURIComponent(iconHtml)}"`;

                    grid.innerHTML += `
                        <div ${btnClick} class="bg-white p-5 rounded-3xl shadow-sm border border-slate-100 hover:shadow-xl hover:-translate-y-1.5 hover:border-brand-light transition-all cursor-pointer text-center group">
                            ${iconHtml}
                            <h3 class="font-bold text-slate-800 text-sm group-hover:text-brand transition-colors line-clamp-1">${app.nama_aplikasi}</h3>
                            <p class="text-[10px] text-slate-500 mt-2 line-clamp-2 leading-relaxed">${app.deskripsi}</p>
                        </div>`;
                });
            } else { grid.innerHTML = '<div class="col-span-full text-center text-red-500 font-semibold">Gagal memuat atau Backend belum siap.</div>'; }
        }

        // Membuka Modal Detail Media Ajar (Pop-up sebelum dibuka di Iframe)
        function openDetailMedia(el) {
            let url = el.getAttribute('data-url');
            let title = el.getAttribute('data-title');
            let desc = decodeURIComponent(el.getAttribute('data-desc'));
            let cover = el.getAttribute('data-cover');
            
            document.getElementById('detail-title').innerText = title;
            document.getElementById('detail-desc').innerText = desc;
            
            let imgContainer = document.getElementById('detail-img-container');
            imgContainer.innerHTML = `<img src="${cover}" class="w-40 h-32 object-cover rounded-2xl shadow-md border-4 border-white mx-auto">`;

            let btnOpen = document.getElementById('btn-open-detail');
            btnOpen.innerHTML = '<i class="fa-solid fa-book-open-reader mr-2"></i> Buka Materi';
            btnOpen.onclick = () => { closeModal('modal-detail'); bukaIframe(url, title); };
            
            showModal('modal-detail');
        }

        async function loadDataMedia() {
            const grid = document.getElementById("grid-media");
            grid.innerHTML = '<div class="col-span-full text-center py-10 text-slate-400"><i class="fa-solid fa-spinner fa-spin text-3xl mb-3"></i><p>Menarik Media RPLBK...</p></div>';
            
            const res = await fetchAPI('getMedia');
            if(res.status === "success") {
                grid.innerHTML = "";
                updateStats('media', res.data.length);
                res.data.forEach(m => {
                    let titleSafe = m.nama_rplbk.replace(/'/g, "\\'");
                    let finalCoverUrl = extractLh3Url(m.url_cover);
                    
                    // Konfigurasi Klik dengan pop-up (Modal Detail)
                    let btnClick = `onclick="openDetailMedia(this)" data-url="${m.url_media}" data-title="${titleSafe}" data-desc="${encodeURIComponent(m.deskripsi)}" data-cover="${finalCoverUrl}"`;

                    grid.innerHTML += `
                        <div ${btnClick} class="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden hover:shadow-xl transition-all group flex flex-col h-full cursor-pointer">
                            <div class="relative overflow-hidden">
                                <img src="${finalCoverUrl}" class="w-full h-44 object-cover bg-slate-100 group-hover:scale-105 transition-transform duration-500" onerror="this.src='https://via.placeholder.com/300x200?text=No+Cover'">
                                <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-60 transition-opacity group-hover:opacity-80"></div>
                                <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                    <div class="bg-white/90 text-brand px-4 py-2 rounded-full font-bold text-xs shadow-lg"><i class="fa-solid fa-eye mr-1"></i> Detail</div>
                                </div>
                            </div>
                            <div class="p-5 flex flex-col flex-1">
                                <h3 class="font-bold text-slate-800 line-clamp-1 text-sm md:text-base group-hover:text-brand transition-colors" title="${m.nama_rplbk}">${m.nama_rplbk}</h3>
                                <p class="text-[11px] text-slate-500 mt-2 line-clamp-2 leading-relaxed flex-1">${m.deskripsi}</p>
                                <div class="mt-4 flex justify-between items-center border-t border-slate-100 pt-4">
                                    <span class="text-[10px] font-semibold text-slate-400 bg-slate-100 px-2 py-1 rounded-md"><i class="fa-solid fa-user-pen mr-1"></i>${m.diupload_oleh.split(' ')[0]}</span>
                                </div>
                            </div>
                        </div>`;
                });
            } else { grid.innerHTML = '<div class="col-span-full text-center text-slate-400 font-semibold">Belum ada media. Klik Upload Baru untuk menambah data.</div>'; }
        }

        // --- RENDER VIDEO (Tetap langsung diputar tanpa detail pop-up) ---
        async function loadDataVideo() {
            const grid = document.getElementById("grid-video");
            grid.innerHTML = '<div class="col-span-full text-center py-10 text-slate-400"><i class="fa-solid fa-spinner fa-spin text-3xl mb-3"></i><p>Menarik Video YouTube...</p></div>';
            const res = await fetchAPI('getVideo');
            if(res.status === "success") {
                grid.innerHTML = "";
                updateStats('video', res.data.length);
                res.data.forEach(v => {
                    let vidId = v.url_youtube.split('v=')[1] || v.url_youtube.split('/')[3];
                    let ampersandPosition = vidId ? vidId.indexOf('&') : -1;
                    if(ampersandPosition != -1) vidId = vidId.substring(0, ampersandPosition);
                    
                    let thumbUrl = v.url_thumbnail || `https://img.youtube.com/vi/${vidId}/maxresdefault.jpg`;
                    let embedUrl = `https://www.youtube.com/embed/${vidId}?autoplay=1`;
                    let titleSafe = v.judul_video.replace(/'/g, "\\'");

                    grid.innerHTML += `
                        <div class="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden hover:shadow-xl transition-all group flex flex-col h-full">
                            <div class="relative cursor-pointer overflow-hidden" onclick="bukaIframe('${embedUrl}', '${titleSafe}')">
                                <img src="${thumbUrl}" onerror="this.src='https://img.youtube.com/vi/${vidId}/hqdefault.jpg'" class="w-full h-44 object-cover group-hover:scale-105 transition-transform duration-500">
                                <div class="absolute inset-0 bg-black/30 flex items-center justify-center transition-colors group-hover:bg-black/50">
                                    <div class="w-14 h-14 bg-red-600 rounded-full flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform">
                                        <i class="fa-solid fa-play text-white text-xl ml-1"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="p-5 flex flex-col flex-1">
                                <h3 class="font-bold text-slate-800 line-clamp-2 text-sm leading-snug flex-1">${v.judul_video}</h3>
                                <div class="mt-3 border-t border-slate-100 pt-3">
                                    <p class="text-[10px] font-semibold text-slate-400 bg-slate-50 inline-block px-2 py-1 rounded-md"><i class="fa-solid fa-clapperboard mr-1"></i>${v.ditambahkan_oleh}</p>
                                </div>
                            </div>
                        </div>`;
                });
            } else { grid.innerHTML = '<div class="col-span-full text-center text-slate-400 font-semibold">Belum ada video ditambahkan.</div>'; }
        }

        // =====================================
        // MANAJEMEN MODAL UMUM & IFRAME
        // =====================================
        function showModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        function bukaIframe(url, title) {
            document.getElementById("iframe-title").innerText = title;
            document.getElementById("main-iframe").src = url;
            document.getElementById("main-iframe").style.opacity = "0";
            document.getElementById("iframe-loader").classList.remove("hidden");
            document.getElementById("iframe-view").classList.remove("hidden");
        }

        function tutupIframe() {
            document.getElementById("main-iframe").src = "";
            document.getElementById("iframe-view").classList.add("hidden");
        }

        function togglePassword(inputId, iconId) {
            const inp = document.getElementById(inputId);
            const ico = document.getElementById(iconId);
            if(inp.type === "password") { inp.type = "text"; ico.className = "fa-solid fa-eye-slash"; } 
            else { inp.type = "password"; ico.className = "fa-solid fa-eye"; }
        }

        function previewImage(input, imgId) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) { document.getElementById(imgId).src = e.target.result; }
                reader.readAsDataURL(input.files[0]);
            }
        }

        const getBase64 = (file) => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = error => reject(error);
        });

        // =====================================
        // AKSI FORM REAL (PROFIL, MEDIA, VIDEO)
        // =====================================
        async function showProfil() {
            document.getElementById('prof-username').value = currentUser.username || '';
            document.getElementById('prof-password').value = currentUser.password || '';
            document.getElementById('prof-nama').value = currentUser.nama_lengkap || '';
            document.getElementById('prof-nip').value = currentUser.nip_nuptk || '';
            document.getElementById('prof-pendidikan').value = currentUser.pendidikan_terakhir || '';
            document.getElementById('prof-tempat-lahir').value = currentUser.tempat_lahir || '';
            document.getElementById('prof-tgl-lahir').value = currentUser.tanggal_lahir ? currentUser.tanggal_lahir.split('T')[0] : '';
            if(currentUser.jenis_kelamin) document.getElementById('prof-jk').value = currentUser.jenis_kelamin;
            document.getElementById('prof-agama').value = currentUser.agama || '';
            document.getElementById('prof-wa').value = currentUser.no_wa || '';
            document.getElementById('prof-email').value = currentUser.email || '';
            document.getElementById('prof-alamat').value = currentUser.alamat_lengkap || '';
            
            let profAvatarUrl = extractLh3Url(currentUser.url_foto_profil);
            document.getElementById('preview-foto-profil').src = profAvatarUrl || `https://ui-avatars.com/api/?name=${currentUser.nama_lengkap}`;
            showModal('modal-profil');
        }

        async function simpanProfil(e) {
            e.preventDefault();
            Swal.fire({ title: 'Menyimpan Profil...', didOpen: () => { Swal.showLoading(); }});
            
            let payload = {
                username: document.getElementById('prof-username').value,
                password: document.getElementById('prof-password').value,
                nama_lengkap: document.getElementById('prof-nama').value,
                nip_nuptk: document.getElementById('prof-nip').value,
                pendidikan_terakhir: document.getElementById('prof-pendidikan').value,
                tempat_lahir: document.getElementById('prof-tempat-lahir').value,
                tanggal_lahir: document.getElementById('prof-tgl-lahir').value,
                jenis_kelamin: document.getElementById('prof-jk').value,
                agama: document.getElementById('prof-agama').value,
                no_wa: document.getElementById('prof-wa').value,
                email: document.getElementById('prof-email').value,
                alamat_lengkap: document.getElementById('prof-alamat').value,
            };

            const fileFoto = document.getElementById('input-foto-profil').files[0];
            if(fileFoto) {
                payload.fotoBase64 = await getBase64(fileFoto);
                payload.fotoMimeType = fileFoto.type;
                payload.fotoNamaFile = "Profil_" + payload.username;
            }

            const res = await fetchAPI('updateProfil', payload);
            if(res.status === "success" || GAS_URL === "URL_APPS_SCRIPT_SAHABAT_DISINI") {
                Swal.fire('Berhasil', 'Profil berhasil diperbarui!', 'success');
                closeModal('modal-profil');
                
                currentUser = { ...currentUser, ...payload }; 
                if(fileFoto) { 
                    const reader = new FileReader();
                    reader.onload = function(e) { currentUser.url_foto_profil = e.target.result; document.getElementById('user-avatar').src = e.target.result; }
                    reader.readAsDataURL(fileFoto);
                }
                document.getElementById('user-display-name').innerText = payload.nama_lengkap;
                document.getElementById('banner-name').innerText = payload.nama_lengkap.split(' ')[0];
            } else { Swal.fire('Gagal', res.pesan || 'Terjadi kesalahan.', 'error'); }
        }

        async function submitMedia(e) {
            e.preventDefault();
            const fileKover = document.getElementById('media-file-kover').files[0];
            const fileDokumen = document.getElementById('media-file-dokumen').files[0];
            
            if(!fileKover || !fileDokumen) { Swal.fire('Error', 'Lengkapi file kover dan materi!', 'error'); return; }

            Swal.fire({ title: 'Mengunggah ke Drive...', text: 'Jangan tutup aplikasi.', didOpen: () => { Swal.showLoading(); }});

            let payload = {
                username_pengunggah: currentUser.username,
                nama_rplbk: document.getElementById('media-judul').value,
                deskripsi: document.getElementById('media-deskripsi').value,
                koverBase64: await getBase64(fileKover),
                koverMimeType: fileKover.type,
                koverNamaFile: "Kover_" + fileKover.name,
                mediaBase64: await getBase64(fileDokumen),
                mediaMimeType: fileDokumen.type,
                mediaNamaFile: "Materi_" + fileDokumen.name
            };

            const res = await fetchAPI('uploadMedia', payload);
            if(res.status === "success" || GAS_URL === "URL_APPS_SCRIPT_SAHABAT_DISINI") {
                Swal.fire('Berhasil', 'Media tersimpan di Drive!', 'success');
                document.getElementById('form-media').reset();
                document.getElementById('label-kover').innerText = "Pilih File (JPG/PNG)";
                document.getElementById('label-dokumen').innerText = "Pilih File (PDF/PPT)";
                closeModal('modal-upload-media');
                loadDataMedia(); 
            } else { Swal.fire('Gagal', res.pesan, 'error'); }
        }

        async function submitVideo(e) {
            e.preventDefault();
            Swal.fire({ title: 'Menyimpan Link Video...', didOpen: () => { Swal.showLoading(); }});
            let payload = {
                username_pengunggah: currentUser.username,
                judul_video: document.getElementById('vid-judul').value,
                deskripsi: document.getElementById('vid-deskripsi').value,
                url_youtube: document.getElementById('vid-url').value
            };
            const res = await fetchAPI('tambahVideo', payload);
            if(res.status === "success" || GAS_URL === "URL_APPS_SCRIPT_SAHABAT_DISINI") {
                Swal.fire('Berhasil', 'Video ditambahkan!', 'success');
                document.getElementById('form-video').reset();
                closeModal('modal-tambah-video');
                loadDataVideo(); 
            } else { Swal.fire('Gagal', res.pesan, 'error'); }
        }

    </script>
</body>
</html>
